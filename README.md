# ç‰ˆæœ¬æ¯”è¾ƒå·¥å…· v2.0

åŸºäºGitLab APIçš„é«˜æ€§èƒ½ç‰ˆæœ¬æ¯”è¾ƒå’Œtaskåˆ†æå·¥å…·ï¼Œä¸“é—¨ç”¨äºæ£€æµ‹ç‰ˆæœ¬é—´çš„taskç¼ºå¤±å’Œæ–°å¢åŠŸèƒ½ã€‚

## ğŸš€ v2.0 é‡å¤§æ›´æ–°

### ğŸ¯ æ ¸å¿ƒæ”¹è¿›
- **æ€§èƒ½æå‡13å€**ï¼šä»262.30sä¼˜åŒ–åˆ°~20s
- **å®Œæ•´æ•°æ®è·å–**ï¼šè·å–å…¨éƒ¨commitsï¼ˆ17,331 + 18,093 = 35,424ä¸ªï¼‰
- **è¯¦ç»†æ—¥å¿—ç³»ç»Ÿ**ï¼šæ¯é¡µè·å–è¿›åº¦ã€ç»Ÿè®¡ä¿¡æ¯ã€æ€§èƒ½æŒ‡æ ‡
- **å»æ‰ç¼“å­˜ä¾èµ–**ï¼šç®€åŒ–é€»è¾‘ï¼Œé¿å…ç¼“å­˜é—®é¢˜
- **ä¼˜åŒ–æ–‡ä»¶å‘½å**ï¼šå»æ‰Optimizedå‰ç¼€ï¼Œæ›´ç®€æ´

### ğŸ“Š æ€§èƒ½å¯¹æ¯”
| æŒ‡æ ‡ | v1.0 | v2.0 | æå‡ |
|------|------|------|------|
| æ€»è€—æ—¶ | 262.30s | ~20s | **13å€** |
| è·å–commits | 100ä¸ª | 35,424ä¸ª | **354å€** |
| æ•°æ®å‡†ç¡®æ€§ | éƒ¨åˆ† | å®Œæ•´ | **100%** |
| å¹¶å‘å¤„ç† | æ—  | 8ä¸ªworker | **8å€** |

### ğŸ”§ æŠ€æœ¯æ¶æ„
- **å¹¶å‘åˆ†é¡µè·å–**ï¼š8ä¸ªworkerå¹¶å‘å¤„ç†
- **æ™ºèƒ½é¡µæ•°æ¢æµ‹**ï¼šäºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿå®šä½æ€»é¡µæ•°
- **æœ¬åœ°å†…å­˜åˆ†æ**ï¼šé¿å…é‡å¤APIè°ƒç”¨
- **è¯¦ç»†æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶ç»Ÿè®¡å’Œæ—¥å¿—

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç¼ºå¤±Taskæ£€æµ‹
- æ£€æµ‹æ—§ç‰ˆæœ¬ä¸­å­˜åœ¨ä½†æ–°ç‰ˆæœ¬ä¸­ç¼ºå¤±çš„GALAXY tasks
- æ”¯æŒä»»æ„GitLab tagç‰ˆæœ¬æ¯”è¾ƒ
- æä¾›è¯¦ç»†çš„taskåˆ—è¡¨å’Œç»Ÿè®¡ä¿¡æ¯

### ğŸ†• æ–°å¢åŠŸèƒ½åˆ†æ
- åˆ†ææ–°ç‰ˆæœ¬ä¸­æ–°å¢çš„featureså’Œtasks
- è¯†åˆ«ç‰ˆæœ¬é—´çš„åŠŸèƒ½å·®å¼‚
- æ”¯æŒæ‰¹é‡åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ

### ğŸ“Š æ€§èƒ½ç›‘æ§
- å®æ—¶æ˜¾ç¤ºè·å–è¿›åº¦å’Œé€Ÿåº¦
- è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯å’Œæ€§èƒ½æŒ‡æ ‡
- æ”¯æŒå¹¶å‘å¤„ç†çŠ¶æ€ç›‘æ§

## ğŸ› ï¸ å®‰è£…é…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- GitLab APIè®¿é—®æƒé™
- å¿…è¦çš„Pythonä¾èµ–åŒ…

### å®‰è£…æ­¥éª¤
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd version-compare-tool2

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®GitLabç›¸å…³é…ç½®
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
GITLAB_URL=https://gitlab.mayidata.com/
GITLAB_TOKEN=your_gitlab_token
GITLAB_PROJECT_ID=130
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œä½¿ç”¨
```bash
# æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
python3 test_v2_core.py

# å¯åŠ¨APIæœåŠ¡
python3 -m src.api.main
```

### 2. APIæ¥å£ä½¿ç”¨

#### ç¼ºå¤±Tasksæ£€æµ‹
```bash
curl -X POST "http://localhost:8000/api/v2/missing-tasks" \
  -H "Content-Type: application/json" \
  -d '{
    "old_version": "6.6.0-ZSJJ-5",
    "new_version": "7.1.0-hf37"
  }'
```

#### æ–°å¢Featuresåˆ†æ
```bash
curl -X POST "http://localhost:8000/api/v2/new-features" \
  -H "Content-Type: application/json" \
  -d '{
    "old_version": "6.6.0-ZSJJ-5", 
    "new_version": "7.1.0-hf37"
  }'
```

### 3. Pythonä»£ç é›†æˆ
```python
from src.gitlab.gitlab_manager_v2 import GitLabManager
from src.core.task_detector_v2 import TaskLossDetector

# åˆå§‹åŒ–
gitlab_manager = GitLabManager(gitlab_url, token, project_id)
detector = TaskLossDetector(gitlab_manager)

# æ£€æµ‹ç¼ºå¤±tasks
result = detector.detect_missing_tasks("6.6.0-ZSJJ-5", "7.1.0-hf37")
print(f"ç¼ºå¤±tasks: {len(result['missing_tasks'])}")

# åˆ†ææ–°å¢features
features = detector.analyze_new_features("6.6.0-ZSJJ-5", "7.1.0-hf37")
print(f"æ–°å¢features: {len(features['new_features'])}")
```

## ğŸ“Š å®é™…æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- é¡¹ç›®ï¼šguandata-core (é¡¹ç›®ID: 130)
- ç‰ˆæœ¬å¯¹æ¯”ï¼š6.6.0-ZSJJ-5 vs 7.1.0-hf37
- æµ‹è¯•æ—¶é—´ï¼š2025-06-16

### æµ‹è¯•ç»“æœ
```
ğŸ¯ ç‰ˆæœ¬taskåˆ†æå®Œæˆ:
    ğŸ“Š æ€»è€—æ—¶: 19.23s (åŸç‰ˆ262.30s)
    âš¡ æ€§èƒ½æå‡: 13.6x å€é€Ÿ
    ğŸ“Š æ—§ç‰ˆæœ¬ 6.6.0-ZSJJ-5: 3371 ä¸ªtasks
    ğŸ“Š æ–°ç‰ˆæœ¬ 7.1.0-hf37: 3966 ä¸ªtasks
    ğŸ” ç¼ºå¤±tasks: 12 ä¸ª
    ğŸ†• æ–°å¢features: 607 ä¸ª
    âœ… å…±åŒtasks: 3359 ä¸ª
```

### è¯¦ç»†ç»Ÿè®¡
- **è·å–commits**ï¼š35,424ä¸ªï¼ˆ17,331 + 18,093ï¼‰
- **å¤„ç†é€Ÿåº¦**ï¼š~900 commits/s
- **å¹¶å‘æ•ˆç‡**ï¼š8ä¸ªworkerå¹¶å‘å¤„ç†
- **æ•°æ®å‡†ç¡®æ€§**ï¼š100%å®Œæ•´æ•°æ®

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
version-compare-tool2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ main.py                 # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ task_detector_v2.py     # Taskæ£€æµ‹å™¨v2
â”‚   â”œâ”€â”€ gitlab/
â”‚   â”‚   â””â”€â”€ gitlab_manager_v2.py    # GitLabç®¡ç†å™¨v2
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ version_service.py      # ç‰ˆæœ¬æ¯”è¾ƒæœåŠ¡
â”œâ”€â”€ docs/                           # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ requirements.txt                # Pythonä¾èµ–
â””â”€â”€ README.md                       # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯

### å¹¶å‘åˆ†é¡µè·å–
- ä½¿ç”¨ThreadPoolExecutorå®ç°8ä¸ªworkerå¹¶å‘
- æ™ºèƒ½äºŒåˆ†æŸ¥æ‰¾æ¢æµ‹æ€»é¡µæ•°
- å®æ—¶è¿›åº¦ç›‘æ§å’Œé”™è¯¯å¤„ç†

### é«˜æ•ˆæ•°æ®å¤„ç†
- æœ¬åœ°å†…å­˜åˆ†æï¼Œé¿å…é‡å¤APIè°ƒç”¨
- æ­£åˆ™è¡¨è¾¾å¼å¿«é€Ÿæå–GALAXY tasks
- é›†åˆè¿ç®—è®¡ç®—å·®å¼‚ï¼Œæ€§èƒ½ä¼˜å¼‚

### è¯¦ç»†æ—¥å¿—ç³»ç»Ÿ
- åˆ†é˜¶æ®µè¿›åº¦æ˜¾ç¤º
- å®æ—¶æ€§èƒ½ç»Ÿè®¡
- è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æ”¯æŒ

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**ï¼šè¯·æ³¨æ„GitLab APIçš„é€Ÿç‡é™åˆ¶
2. **ç½‘ç»œç¨³å®šæ€§**ï¼šå¤§é‡æ•°æ®è·å–éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. **å†…å­˜ä½¿ç”¨**ï¼šå¤„ç†å¤§é‡commitsæ—¶æ³¨æ„å†…å­˜ä½¿ç”¨æƒ…å†µ
4. **Tokenæƒé™**ï¼šç¡®ä¿GitLab tokenæœ‰è¶³å¤Ÿçš„é¡¹ç›®è®¿é—®æƒé™

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¹¶å‘æ•°è°ƒæ•´**ï¼šæ ¹æ®ç½‘ç»œå’ŒæœåŠ¡å™¨æ€§èƒ½è°ƒæ•´workeræ•°é‡
2. **åˆ†é¡µå¤§å°**ï¼šå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´æ¯é¡µè·å–çš„commitsæ•°é‡
3. **ç¼“å­˜ç­–ç•¥**ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ•°æ®å¯è€ƒè™‘æ·»åŠ ç¼“å­˜
4. **é”™è¯¯é‡è¯•**ï¼šç½‘ç»œä¸ç¨³å®šæ—¶å¯å¢åŠ é‡è¯•æœºåˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªå·¥å…·ï¼

## ï¿½ï¿½ è®¸å¯è¯

MIT License 